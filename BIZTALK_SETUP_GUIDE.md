# ë¹„ì¦ˆí†¡(BizTalk) ì•Œë¦¼í†¡ API ì—°ë™ ê°€ì´ë“œ

## ðŸ“‹ ê°œìš”

ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼í†¡ì€ ì œíœ´ì‚¬ë¥¼ í†µí•˜ê±°ë‚˜ **ë¹„ì¦ˆí†¡(BizTalk)**ì„ í†µí•´ APIë¡œ ìžë™ ë°œì†¡í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ìžë™í™”ë¥¼ ìœ„í•´ì„œëŠ” ë¹„ì¦ˆí†¡ ì—°ë™ì´ í•„ìš”í•©ë‹ˆë‹¤.

---

## ðŸ” ì•Œë¦¼í†¡ ë°œì†¡ ë°©ì‹ ë¹„êµ

### ë°©ì‹ 1: ì œíœ´ì‚¬ë¥¼ í†µí•œ ë°œì†¡
- **íŠ¹ì§•:** ì œíœ´ì‚¬ í”Œëž«í¼ ì‚¬ìš©
- **ìž¥ì :** ê°„íŽ¸í•œ ì„¤ì •
- **ë‹¨ì :** ì œíœ´ì‚¬ ë¹„ìš© ì¶”ê°€, ìžë™í™” ì œí•œì 

### ë°©ì‹ 2: ë¹„ì¦ˆí†¡ API ì—°ë™ (ê¶Œìž¥)
- **íŠ¹ì§•:** ì§ì ‘ API ì—°ë™
- **ìž¥ì :** ì™„ì „í•œ ìžë™í™” ê°€ëŠ¥, n8nê³¼ ì§ì ‘ ì—°ë™
- **ë‹¨ì :** ì´ˆê¸° ì„¤ì • ë³µìž¡

---

## 1ë‹¨ê³„: ë¹„ì¦ˆí†¡ ì„œë¹„ìŠ¤ ì‹ ì²­

### 1-1. ë¹„ì¦ˆí†¡ì´ëž€?

**ë¹„ì¦ˆí†¡(BizTalk)**ì€ ì¹´ì¹´ì˜¤ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì‹œì§€ ë°œì†¡ í”Œëž«í¼ìœ¼ë¡œ, APIë¥¼ í†µí•´ ì•Œë¦¼í†¡ì„ ìžë™ìœ¼ë¡œ ë°œì†¡í•  ìˆ˜ ìžˆëŠ” ì„œë¹„ìŠ¤ìž…ë‹ˆë‹¤.

### 1-2. ë¹„ì¦ˆí†¡ ì„œë¹„ìŠ¤ ì‹ ì²­

**ë°©ë²• 1: ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ì—ì„œ ì‹ ì²­**

1. [ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤](https://business.kakao.com/) ì ‘ì†
2. ë¡œê·¸ì¸
3. **"ì„œë¹„ìŠ¤"** â†’ **"ë¹„ì¦ˆí†¡"** ë˜ëŠ” **"API ë°œì†¡"** ë©”ë‰´ ì°¾ê¸°
4. **"ë¹„ì¦ˆí†¡ ì‹œìž‘í•˜ê¸°"** ë˜ëŠ” **"ì„œë¹„ìŠ¤ ì‹ ì²­"** í´ë¦­
5. ì„œë¹„ìŠ¤ ì•½ê´€ ë™ì˜
6. ì‹ ì²­ ì™„ë£Œ

**ë°©ë²• 2: ê³ ê°ì„¼í„° ë¬¸ì˜**

1. ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ ê³ ê°ì„¼í„° ë¬¸ì˜
2. ë¬¸ì˜ ë‚´ìš©: "ë¹„ì¦ˆí†¡ API ì—°ë™ ì„œë¹„ìŠ¤ ì‹ ì²­"
3. ì‹ ì²­ ì ˆì°¨ ì•ˆë‚´ ë°›ê¸°

**ë°©ë²• 3: ì¹´ì¹´ì˜¤ ê°œë°œìž ì½˜ì†”ì—ì„œ í™•ì¸**

1. [ì¹´ì¹´ì˜¤ ê°œë°œìž ì½˜ì†”](https://developers.kakao.com/) ì ‘ì†
2. **"ì•± ì„¤ì •"** â†’ **"ì œí’ˆ ì„¤ì •"** â†’ **"ì¹´ì¹´ì˜¤í†¡ ë©”ì‹œì§€"** í™•ì¸
3. ë¹„ì¦ˆí†¡ ì—°ë™ ì˜µì…˜ í™•ì¸

---

## 2ë‹¨ê³„: ë¹„ì¦ˆí†¡ API ì¸ì¦ ì •ë³´ ë°œê¸‰

### 2-1. API Key ë°œê¸‰

ë¹„ì¦ˆí†¡ ì„œë¹„ìŠ¤ ìŠ¹ì¸ í›„:

1. ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ ì½˜ì†” â†’ **"ë¹„ì¦ˆí†¡"** â†’ **"API ì„¤ì •"**
2. **"API Key ë°œê¸‰"** í´ë¦­
3. API Key ë³µì‚¬ ë° ë³´ê´€

### 2-2. ì„œë¹„ìŠ¤ ê³„ì • ìƒì„±

1. **"ì„œë¹„ìŠ¤ ê³„ì •"** â†’ **"ê³„ì • ìƒì„±"**
2. ê³„ì • ì •ë³´ ìž…ë ¥
3. ê³„ì • ìƒì„± ì™„ë£Œ

---

## 3ë‹¨ê³„: ì•Œë¦¼í†¡ í…œí”Œë¦¿ ë“±ë¡

### 3-1. í…œí”Œë¦¿ ë“±ë¡

1. ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ ì½˜ì†” â†’ **"ì•Œë¦¼í†¡"** â†’ **"í…œí”Œë¦¿ ê´€ë¦¬"**
2. **"í…œí”Œë¦¿ ë§Œë“¤ê¸°"** í´ë¦­

**í…œí”Œë¦¿ ì •ë³´:**

**í…œí”Œë¦¿ ì´ë¦„:**
```
ì˜ˆì•½ ì™„ë£Œ ì•ˆë‚´
```

**í…œí”Œë¦¿ ë‚´ìš©:**
```
#{guest_name}ë‹˜, OUSCARAVAN ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!

ðŸ“… ì˜ˆì•½ë²ˆí˜¸: #{reservation_number}
ðŸ“… ì²´í¬ì¸: #{checkin_date} 15:00
ðŸ“… ì²´í¬ì•„ì›ƒ: #{checkout_date} 11:00
ðŸ  ê°ì‹¤: #{room_type}
ðŸ’° ê²°ì œê¸ˆì•¡: #{amount}ì›

ì»¨ì‹œì–´ì§€ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì‹œë ¤ë©´ ì•„ëž˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
```

**ë²„íŠ¼ ì¶”ê°€:**
- **ë²„íŠ¼ ìœ í˜•**: ë§í¬ ë²„íŠ¼
- **ë²„íŠ¼ ì´ë¦„**: `ì»¨ì‹œì–´ì§€ ì„œë¹„ìŠ¤ ì´ìš©í•˜ê¸°`
- **ë§í¬**: `#{service_link}`

**í…œí”Œë¦¿ ë³€ìˆ˜:**
- `#{guest_name}`: ê²ŒìŠ¤íŠ¸ ì´ë¦„
- `#{reservation_number}`: ì˜ˆì•½ë²ˆí˜¸
- `#{checkin_date}`: ì²´í¬ì¸ ë‚ ì§œ
- `#{checkout_date}`: ì²´í¬ì•„ì›ƒ ë‚ ì§œ
- `#{room_type}`: ê°ì‹¤ íƒ€ìž…
- `#{amount}`: ê²°ì œê¸ˆì•¡
- `#{service_link}`: ì»¨ì‹œì–´ì§€ ì„œë¹„ìŠ¤ ë§í¬

3. **ì €ìž¥** í´ë¦­
4. í…œí”Œë¦¿ ìŠ¹ì¸ ëŒ€ê¸° (1-2ì¼)

### 3-2. í…œí”Œë¦¿ ì½”ë“œ í™•ì¸

í…œí”Œë¦¿ ìŠ¹ì¸ ì™„ë£Œ í›„:

1. í…œí”Œë¦¿ ëª©ë¡ì—ì„œ ìŠ¹ì¸ëœ í…œí”Œë¦¿ í´ë¦­
2. **"í…œí”Œë¦¿ ì½”ë“œ"** ë³µì‚¬
3. n8n í™˜ê²½ ë³€ìˆ˜ì— ì €ìž¥

---

## 4ë‹¨ê³„: ë¹„ì¦ˆí†¡ API ì—°ë™ (n8n)

### 4-1. ë¹„ì¦ˆí†¡ API ì—”ë“œí¬ì¸íŠ¸

**ì•Œë¦¼í†¡ ë°œì†¡ API:**
```
POST https://kapi.kakao.com/v2/api/talk/memo/send
```

**ë˜ëŠ” ë¹„ì¦ˆí†¡ ì „ìš© ì—”ë“œí¬ì¸íŠ¸:**
```
POST https://kapi.kakao.com/v1/alimtalk/send
```

### 4-2. ì¸ì¦ ë°©ë²•

**Option A: Access Token ì‚¬ìš© (ê¸°ì¡´ ë°©ì‹)**

ê¸°ì¡´ì— ë°œê¸‰ë°›ì€ Access Token ì‚¬ìš©:
- `Authorization: Bearer {{ $env.KAKAO_ACCESS_TOKEN }}`

**Option B: ë¹„ì¦ˆí†¡ API Key ì‚¬ìš©**

ë¹„ì¦ˆí†¡ì—ì„œ ë°œê¸‰ë°›ì€ API Key ì‚¬ìš©:
- `Authorization: Bearer {{ $env.BIZTALK_API_KEY }}`

### 4-3. n8n HTTP Request ë…¸ë“œ ì„¤ì •

**Method**: `POST`

**URL**: `https://kapi.kakao.com/v1/alimtalk/send`

**Headers:**
- `Authorization`: `Bearer {{ $env.KAKAO_ACCESS_TOKEN }}`
- `Content-Type`: `application/json`

**Body (JSON):**
```json
{
  "receiver_uuids": ["{{ $json.phone }}"],
  "template_code": "{{ $env.ALIMTALK_TEMPLATE_CODE }}",
  "template_args": {
    "#{guest_name}": "{{ $json.guest }}",
    "#{reservation_number}": "{{ $json.reservationNumber }}",
    "#{checkin_date}": "{{ $json.checkin }}",
    "#{checkout_date}": "{{ $json.checkout }}",
    "#{room_type}": "{{ $json.room }}",
    "#{amount}": "{{ $json.amount }}",
    "#{service_link}": "{{ $json.link }}"
  }
}
```

**ì¤‘ìš”:**
- `receiver_uuids`: ì „í™”ë²ˆí˜¸ ë°°ì—´ (í•˜ì´í”ˆ ì œê±°, ì˜ˆ: "01012345678")
- `template_code`: ìŠ¹ì¸ë°›ì€ í…œí”Œë¦¿ ì½”ë“œ
- `template_args`: í…œí”Œë¦¿ ë³€ìˆ˜ ë§¤í•‘

---

## 5ë‹¨ê³„: n8n ì›Œí¬í”Œë¡œìš° ìˆ˜ì •

### 5-1. ê¸°ì¡´ ì›Œí¬í”Œë¡œìš° êµ¬ì¡°

```
Gmail Trigger
  â†“
IF (ì˜ˆì•½ í™•ì •/ì·¨ì†Œ êµ¬ë¶„)
  â†“
Code (ì´ë©”ì¼ íŒŒì‹±)
  â†“
Set (ë°ì´í„° ì •ë¦¬)
  â†“
Code (ê³ ìœ  ë§í¬ ìƒì„±)
  â†“
Code (ì „í™”ë²ˆí˜¸ í¬ë§· ë³€í™˜) â† ì¶”ê°€
  â†“
HTTP Request (ë¹„ì¦ˆí†¡ API ë°œì†¡) â† ìˆ˜ì •
```

### 5-2. ì „í™”ë²ˆí˜¸ í¬ë§· ë³€í™˜ ë…¸ë“œ

**Code ë…¸ë“œ ì¶”ê°€:**

```javascript
// ì „í™”ë²ˆí˜¸ì—ì„œ í•˜ì´í”ˆ ì œê±° ë° í¬ë§· ì •ë¦¬
let phone = $input.item.json.phone || '';

// í•˜ì´í”ˆ, ê³µë°±, ê´„í˜¸ ì œê±°
phone = phone.replace(/[-\s()]/g, '');

// êµ­ì œë²ˆí˜¸ ì œê±° (010ìœ¼ë¡œ ì‹œìž‘í•˜ëŠ” ê²½ìš°)
if (phone.startsWith('010')) {
  phone = phone.substring(0, 11); // 01012345678 í˜•ì‹
} else if (phone.startsWith('82')) {
  // 82ë¡œ ì‹œìž‘í•˜ëŠ” ê²½ìš° (êµ­ì œë²ˆí˜¸)
  phone = '0' + phone.substring(2);
  if (phone.length > 11) {
    phone = phone.substring(0, 11);
  }
}

// ì „í™”ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬
if (!phone || phone.length < 10) {
  throw new Error(`ìœ íš¨í•˜ì§€ ì•Šì€ ì „í™”ë²ˆí˜¸: ${phone}`);
}

return {
  ...$input.item.json,
  phone: phone,
  phone_formatted: phone
};
```

### 5-3. HTTP Request ë…¸ë“œ ì„¤ì • (ë¹„ì¦ˆí†¡ API)

**Method**: `POST`

**URL**: `https://kapi.kakao.com/v1/alimtalk/send`

**Authentication:**
- Type: `Header Auth`
- Header Name: `Authorization`
- Header Value: `Bearer {{ $env.KAKAO_ACCESS_TOKEN }}`

**Headers:**
- `Content-Type`: `application/json`

**Body (JSON):**
```json
{
  "receiver_uuids": ["{{ $json.phone }}"],
  "template_code": "{{ $env.ALIMTALK_TEMPLATE_CODE }}",
  "template_args": {
    "#{guest_name}": "{{ $json.guest }}",
    "#{reservation_number}": "{{ $json.reservationNumber }}",
    "#{checkin_date}": "{{ $json.checkin }}",
    "#{checkout_date}": "{{ $json.checkout }}",
    "#{room_type}": "{{ $json.room }}",
    "#{amount}": "{{ $json.amount }}",
    "#{service_link}": "{{ $json.link }}"
  }
}
```

---

## 6ë‹¨ê³„: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

### 6-1. n8n í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€

1. n8n ìƒë‹¨ ë©”ë‰´ â†’ **Settings** (âš™ï¸ ì•„ì´ì½˜)
2. **Environment Variables** í´ë¦­
3. ë‹¤ìŒ ë³€ìˆ˜ ì¶”ê°€:

| Name | Value | ì„¤ëª… |
|------|-------|------|
| `ALIMTALK_TEMPLATE_CODE` | í…œí”Œë¦¿ ì½”ë“œ | ìŠ¹ì¸ë°›ì€ ì•Œë¦¼í†¡ í…œí”Œë¦¿ ì½”ë“œ |
| `KAKAO_ACCESS_TOKEN` | Access Token | ê¸°ì¡´ ìœ ì§€ ë˜ëŠ” ë¹„ì¦ˆí†¡ API Key |
| `BIZTALK_API_KEY` | API Key | ë¹„ì¦ˆí†¡ì—ì„œ ë°œê¸‰ë°›ì€ API Key (ì„ íƒ) |
| `WEB_APP_URL` | ì›¹ ì•± URL | ê¸°ì¡´ ìœ ì§€ |

---

## 7ë‹¨ê³„: í…ŒìŠ¤íŠ¸

### 7-1. ë‹¨ì¼ í…ŒìŠ¤íŠ¸

1. **"ì „í™”ë²ˆí˜¸ í¬ë§· ë³€í™˜"** ë…¸ë“œì—ì„œ **"Execute Node"** í´ë¦­
2. ì „í™”ë²ˆí˜¸ í¬ë§· í™•ì¸
3. **"HTTP Request"** ë…¸ë“œì—ì„œ **"Execute Node"** í´ë¦­
4. ë¹„ì¦ˆí†¡ API ì‘ë‹µ í™•ì¸

### 7-2. ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸

1. í…ŒìŠ¤íŠ¸ìš© ë„¤ì´ë²„ ì˜ˆì•½ ì™„ë£Œ ì´ë©”ì¼ ë°œì†¡
2. n8n ì›Œí¬í”Œë¡œìš° ìžë™ ì‹¤í–‰ í™•ì¸
3. ê° ë…¸ë“œ ì‹¤í–‰ ê²°ê³¼ í™•ì¸
4. ì•Œë¦¼í†¡ ìˆ˜ì‹  í™•ì¸

---

## ðŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë¹„ì¦ˆí†¡ ì„œë¹„ìŠ¤ ì‹ ì²­
- [ ] ë¹„ì¦ˆí†¡ ì„œë¹„ìŠ¤ ì‹ ì²­
- [ ] ì„œë¹„ìŠ¤ ìŠ¹ì¸ ì™„ë£Œ (1-2ì¼)
- [ ] API Key ë°œê¸‰
- [ ] ì„œë¹„ìŠ¤ ê³„ì • ìƒì„±

### í…œí”Œë¦¿ ì„¤ì •
- [ ] ì•Œë¦¼í†¡ í…œí”Œë¦¿ ë“±ë¡
- [ ] í…œí”Œë¦¿ ìŠ¹ì¸ ì™„ë£Œ
- [ ] í…œí”Œë¦¿ ì½”ë“œ í™•ì¸

### n8n ì„¤ì •
- [ ] í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€
- [ ] ì „í™”ë²ˆí˜¸ í¬ë§· ë³€í™˜ ë…¸ë“œ ì¶”ê°€
- [ ] HTTP Request ë…¸ë“œ ìˆ˜ì • (ë¹„ì¦ˆí†¡ API)
- [ ] í…ŒìŠ¤íŠ¸ ì‹¤í–‰

---

## ðŸ†˜ ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: "401 Unauthorized" ì˜¤ë¥˜

**ì›ì¸:** Access Token ë§Œë£Œ ë˜ëŠ” ìž˜ëª»ë¨

**í•´ê²°:**
1. Access Token ìœ íš¨ì„± í™•ì¸
2. ë¹„ì¦ˆí†¡ API Key ì‚¬ìš© ì‹œë„
3. Refresh Tokenìœ¼ë¡œ ê°±ì‹ 

### ë¬¸ì œ 2: "403 Forbidden" ì˜¤ë¥˜

**ì›ì¸:** ë¹„ì¦ˆí†¡ ì„œë¹„ìŠ¤ ë¯¸ìŠ¹ì¸ ë˜ëŠ” ê¶Œí•œ ì—†ìŒ

**í•´ê²°:**
1. ë¹„ì¦ˆí†¡ ì„œë¹„ìŠ¤ ìŠ¹ì¸ ìƒíƒœ í™•ì¸
2. API Key ê¶Œí•œ í™•ì¸
3. ê³ ê°ì„¼í„° ë¬¸ì˜

### ë¬¸ì œ 3: "400 Bad Request" ì˜¤ë¥˜

**ì›ì¸:**
- í…œí”Œë¦¿ ë³€ìˆ˜ëª… ë¶ˆì¼ì¹˜
- ì „í™”ë²ˆí˜¸ í˜•ì‹ ì˜¤ë¥˜
- í•„ìˆ˜ ë³€ìˆ˜ ëˆ„ë½

**í•´ê²°:**
1. í…œí”Œë¦¿ ë³€ìˆ˜ëª… ì •í™•ížˆ ì¼ì¹˜ í™•ì¸
2. ì „í™”ë²ˆí˜¸ í¬ë§· í™•ì¸ (í•˜ì´í”ˆ ì œê±°, 11ìžë¦¬)
3. ëª¨ë“  í•„ìˆ˜ ë³€ìˆ˜ í¬í•¨ í™•ì¸

---

## ðŸ’¡ ì°¸ê³ ì‚¬í•­

### ë¹„ì¦ˆí†¡ vs ì œíœ´ì‚¬

**ë¹„ì¦ˆí†¡ (ì§ì ‘ API ì—°ë™):**
- âœ… ì™„ì „í•œ ìžë™í™” ê°€ëŠ¥
- âœ… n8nê³¼ ì§ì ‘ ì—°ë™
- âœ… ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥
- âŒ ì´ˆê¸° ì„¤ì • ë³µìž¡
- âŒ API ê´€ë¦¬ í•„ìš”

**ì œíœ´ì‚¬ í”Œëž«í¼:**
- âœ… ê°„íŽ¸í•œ ì„¤ì •
- âœ… ê´€ë¦¬í˜• ì„œë¹„ìŠ¤
- âŒ ì œíœ´ì‚¬ ë¹„ìš© ì¶”ê°€
- âŒ ìžë™í™” ì œí•œì 

### ë¹„ìš©

- **ì•Œë¦¼í†¡ ë°œì†¡ ë¹„ìš©:** ê±´ë‹¹ 20-30ì›
- **ë¹„ì¦ˆí†¡ ì„œë¹„ìŠ¤:** ê¸°ë³¸ ì„œë¹„ìŠ¤ (ì¶”ê°€ ë¹„ìš© ì—†ìŒ)
- **ì›”ë › ì¶©ì „ í•„ìš”:** ë°œì†¡ ì „ ì›”ë ›ì— ì¶©ì „ í•„ìš”

---

## ðŸŽ¯ ìµœì¢… ì›Œí¬í”Œë¡œìš° êµ¬ì¡°

```
[ë„¤ì´ë²„ ì˜ˆì•½ ì™„ë£Œ]
  â†“
[ì˜ˆì•½ ì™„ë£Œ ì´ë©”ì¼ ë°œì†¡]
  â†“
[n8n Gmail Trigger]
  â†“
[IF: ì˜ˆì•½ í™•ì •/ì·¨ì†Œ êµ¬ë¶„]
  â†“
[Code: ì´ë©”ì¼ íŒŒì‹±]
  â†“
[Set: ë°ì´í„° ì •ë¦¬]
  â†“
[Code: ê³ ìœ  ë§í¬ ìƒì„±]
  â†“
[Code: ì „í™”ë²ˆí˜¸ í¬ë§· ë³€í™˜]
  â†“
[HTTP Request: ë¹„ì¦ˆí†¡ API ì•Œë¦¼í†¡ ë°œì†¡]
  â†“
[ì•Œë¦¼í†¡ ìˆ˜ì‹ ]
  â†“
[ê²ŒìŠ¤íŠ¸ê°€ ì±„ë„ ì¹œêµ¬ ì¶”ê°€] (ìœ ë„)
  â†“
[í–¥í›„ ë§ˆì¼€íŒ… ì¹œêµ¬í†¡ ë°œì†¡]
```

---

**ë¬¸ì„œ ë²„ì „**: 1.0  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2024-01-15

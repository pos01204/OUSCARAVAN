# 카카오톡 메시지 API 설정 가이드 (현재 화면 기준)

## 📊 현재 상태

**앱 이름**: OUSCARAVAN Concierge  
**앱 ID**: 1363679  
**현재 상태**: 
- 카카오 로그인: 설정 안 함
- 카카오톡 메시지: 설정 필요

---

## 🎯 목표

n8n에서 카카오톡 메시지를 자동으로 발송하기 위한 설정입니다.

---

## 1단계: 카카오 로그인 활성화 (필수)

카카오톡 메시지를 발송하려면 먼저 카카오 로그인을 활성화해야 합니다.

### 현재 화면에서:

1. 왼쪽 사이드바에서 **"제품 설정"** → **"카카오 로그인"** 클릭
2. **"설정"** 버튼 클릭

### 카카오 로그인 설정:

#### 1. 활성화 설정

1. **활성화 설정** 토글을 **ON**으로 변경
2. **저장** 클릭

#### 2. Redirect URI 설정

1. **Redirect URI** 섹션에서 **URI 추가** 클릭
2. 다음 URI 추가:
   ```
   https://ouscaravan.com/auth/kakao/callback
   ```
   (또는 실제 배포된 도메인)
3. **저장** 클릭

#### 3. 동의항목 설정

1. **동의항목** 탭 클릭
2. **필수 동의항목** 또는 **선택 동의항목**에서:
   - **전화번호**: 선택 (카카오톡 메시지 발송에 필요)
   - **카카오톡 메시지 전송**: 선택 (필수)
3. **저장** 클릭

---

## 2단계: 카카오톡 메시지 활성화

### 현재 화면에서:

1. 왼쪽 사이드바에서 **"제품 설정"** → **"카카오톡 메시지"** 클릭
2. 메시지 설정 페이지로 이동

### 메시지 API 활성화:

#### 옵션 A: 친구톡 (1:1 메시지, 무료)

1. **친구톡** 섹션 확인
2. **활성화 설정** 토글을 **ON**으로 변경
3. **저장** 클릭

**제한사항:**
- ⚠️ 사용자가 친구 추가 필요
- ⚠️ 일일 발송 한도 존재
- ⚠️ 스팸 필터 적용 가능

#### 옵션 B: 알림톡 (비즈니스용, 유료, 권장)

**알림톡을 사용하려면 비즈 앱으로 전환해야 합니다.**

1. 대시보드로 돌아가기
2. **"비즈 앱 등록"** 버튼 클릭
3. 사업자 정보 입력 및 비즈 앱 전환
4. [카카오 비즈니스](https://business.kakao.com/)에서 알림톡 서비스 신청

---

## 3단계: 앱 키 확인

### 현재 화면에서:

1. 왼쪽 사이드바에서 **"앱"** → **"앱 키"** 클릭
2. **REST API 키** 복사
   - 나중에 n8n 환경 변수에 사용

---

## 4단계: 플랫폼 설정

### 현재 화면에서:

1. 왼쪽 사이드바에서 **"앱"** → **"플랫폼"** 클릭
2. **Web 플랫폼 등록** 클릭
3. **사이트 도메인** 입력:
   ```
   https://ouscaravan.com
   ```
4. **저장** 클릭

---

## 5단계: Access Token 발급

### 방법 1: 카카오 개발자 도구 사용 (권장)

1. [카카오 개발자 도구](https://developers.kakao.com/tool) 접속
2. **REST API 테스트** 메뉴 선택
3. **토큰 발급** 클릭
4. 앱 선택: **OUSCARAVAN Concierge**
5. 권한 승인
6. **access_token**과 **refresh_token** 복사

### 방법 2: 수동 발급

1. 다음 URL로 접속 (브라우저):
   ```
   https://kauth.kakao.com/oauth/authorize?client_id=YOUR_REST_API_KEY&redirect_uri=YOUR_REDIRECT_URI&response_type=code
   ```
   - `YOUR_REST_API_KEY`: 3단계에서 복사한 REST API 키
   - `YOUR_REDIRECT_URI`: 설정한 Redirect URI
2. 권한 승인
3. 리디렉션된 URL에서 **code** 파라미터 복사
4. Postman 또는 curl로 토큰 발급

---

## 6단계: n8n 환경 변수 설정

1. n8n 상단 메뉴 → **Settings** (⚙️ 아이콘)
2. **Environment Variables** 클릭
3. 다음 변수 추가:

| Name | Value |
|------|-------|
| `KAKAO_REST_API_KEY` | 카카오 REST API 키 (3단계에서 복사) |
| `KAKAO_ACCESS_TOKEN` | Access Token (5단계에서 발급) |
| `KAKAO_REFRESH_TOKEN` | Refresh Token (5단계에서 발급, 선택사항) |
| `WEB_APP_URL` | `https://ouscaravan.com` |

---

## 7단계: 테스트

### Access Token 유효성 확인

n8n에서 HTTP Request 노드로 테스트:

1. 새 워크플로우 생성 (테스트용)
2. HTTP Request 노드 추가
3. 설정:
   - **Method**: `GET`
   - **URL**: `https://kapi.kakao.com/v1/user/access_token_info`
   - **Authentication**: Header Auth
   - **Header Name**: `Authorization`
   - **Header Value**: `Bearer {{ $env.KAKAO_ACCESS_TOKEN }}`
4. **Execute step** 클릭
5. 응답 확인:
   - `200 OK`: 토큰 유효 ✅
   - `401 Unauthorized`: 토큰 만료 또는 무효 ❌

---

## 📋 설정 체크리스트

### 카카오 개발자 콘솔
- [ ] 카카오 로그인 활성화
  - [ ] 활성화 설정 ON
  - [ ] Redirect URI 추가
  - [ ] 동의항목 설정 (전화번호, 카카오톡 메시지 전송)
- [ ] 카카오톡 메시지 활성화
  - [ ] 친구톡 활성화 (또는 알림톡)
- [ ] 앱 키 확인
  - [ ] REST API 키 복사
- [ ] 플랫폼 설정
  - [ ] Web 플랫폼 등록
  - [ ] 사이트 도메인 입력

### Access Token
- [ ] Access Token 발급
- [ ] Refresh Token 발급 (선택사항)
- [ ] 토큰 유효성 확인

### n8n 설정
- [ ] 환경 변수 추가
  - [ ] KAKAO_REST_API_KEY
  - [ ] KAKAO_ACCESS_TOKEN
  - [ ] KAKAO_REFRESH_TOKEN (선택사항)
  - [ ] WEB_APP_URL
- [ ] HTTP Request 노드 설정 확인
- [ ] 테스트 실행

---

## 🎯 빠른 시작 (친구톡 사용)

### 1. 카카오 로그인 활성화

1. 왼쪽 사이드바: **"제품 설정"** → **"카카오 로그인"**
2. **"설정"** 버튼 클릭
3. **활성화 설정** ON
4. **Redirect URI** 추가
5. **동의항목** 설정
6. **저장**

### 2. 카카오톡 메시지 활성화

1. 왼쪽 사이드바: **"제품 설정"** → **"카카오톡 메시지"**
2. **친구톡** 활성화
3. **저장**

### 3. REST API 키 복사

1. 왼쪽 사이드바: **"앱"** → **"앱 키"**
2. **REST API 키** 복사

### 4. Access Token 발급

1. [카카오 개발자 도구](https://developers.kakao.com/tool) 접속
2. **REST API 테스트** → **토큰 발급**
3. 토큰 복사

### 5. n8n 환경 변수 설정

1. n8n Settings → Environment Variables
2. 변수 추가

---

## ⚠️ 중요 사항

### 친구톡 사용 시

- 사용자가 친구 추가해야 메시지 수신 가능
- 일일 발송 한도 존재
- 스팸 필터 적용 가능

### 알림톡 사용 시

- 비즈 앱으로 전환 필요
- 카카오 비즈니스 채널 생성 필요
- 템플릿 등록 및 승인 필요
- 유료 서비스 (건당 과금)

---

## 🆘 문제 해결

### "카카오 로그인 설정 안 함" 오류

**해결 방법:**
1. **"제품 설정"** → **"카카오 로그인"** 클릭
2. **"설정"** 버튼 클릭
3. 활성화 설정 ON

### "카카오톡 메시지 설정 안 함" 오류

**해결 방법:**
1. **"제품 설정"** → **"카카오톡 메시지"** 클릭
2. 친구톡 또는 알림톡 활성화

### Access Token 발급 실패

**해결 방법:**
1. 카카오 로그인이 활성화되어 있는지 확인
2. Redirect URI가 올바르게 설정되어 있는지 확인
3. 동의항목이 올바르게 설정되어 있는지 확인

---

**문서 버전**: 1.0  
**최종 업데이트**: 2024-01-15

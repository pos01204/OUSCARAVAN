# SolAPI를 통한 알림톡 설정 및 전환 가이드

## 📋 전략 개요

### 목표
- 예약 완료 시 **SolAPI**를 통해 알림톡으로 즉시 자동 발송
- 카카오톡 채널 친구 추가 유도
- 향후 마케팅을 위한 친구톡 활용 기반 구축

### SolAPI 선택 이유
- ✅ n8n 공식 노드 지원 (설정 간편)
- ✅ 가입 조건 상대적으로 간단
- ✅ 카카오 알림톡, 네이버 메시지, SMS 통합 관리
- ✅ 템플릿 관리 용이

### 전략 흐름
```
[예약 완료]
  ↓
[알림톡 발송] (즉시, 친구 추가 불필요)
  ↓
[채널 친구 추가 유도 메시지 포함]
  ↓
[친구 추가 완료]
  ↓
[향후 마케팅 친구톡 발송]
```

---

## 1단계: 카카오 비즈니스 채널 생성

### 1-1. 카카오 비즈니스 접속

1. [카카오 비즈니스](https://business.kakao.com/) 접속
2. 카카오 계정으로 로그인
3. **"비즈니스 시작하기"** 또는 **"채널 만들기"** 클릭

### 1-2. 비즈니스 채널 생성

**필수 정보 입력:**

1. **채널 유형 선택**
   - 일반 비즈니스 채널 선택
   - 또는 숙박/관광 관련 카테고리 선택

2. **채널 정보 입력**
   - **채널 이름**: `OUSCARAVAN`
   - **채널 설명**: `프리미엄 캠핑장/글램핑 컨시어지 서비스`
   - **대표 이미지**: 채널 프로필 이미지 업로드
   - **연락처**: 전화번호 입력

3. **사업자 정보 입력**
   - 회사명: `오우스카라반`
   - 사업자 등록번호: `887-08-01964`
   - 대표자명: 입력
   - 사업자등록증 업로드

4. **생성** 클릭

### 1-3. 채널 인증 완료

- 채널 생성 후 인증 절차 진행
- 인증 완료까지 1-2일 소요 가능

---

## 2단계: SolAPI 서비스 신청

### 2-1. SolAPI란?

**SolAPI**는 n8n에 공식 노드로 등록되어 있어 카카오 알림톡, 네이버 메시지, SMS를 간편하게 발송할 수 있는 서비스입니다.

**장점:**
- ✅ n8n 공식 노드 지원 (설정 간편)
- ✅ 가입 조건 상대적으로 간단
- ✅ 카카오 알림톡, 네이버 메시지, SMS 통합 관리
- ✅ 템플릿 관리 용이

### 2-2. SolAPI 서비스 신청

1. [SolAPI](https://solapi.com/) 접속
2. **"회원가입"** 클릭
3. 사업자 정보 입력:
   - 회사명: `오우스카라반`
   - 사업자 등록번호: `887-08-01964`
   - 대표자명: 입력
4. 가입 완료

### 2-3. SolAPI 서비스 활성화

1. SolAPI 콘솔 로그인
2. **"서비스 신청"** 메뉴 확인
3. 필요한 서비스 활성화:
   - 카카오 알림톡
   - 네이버 메시지 (선택)
   - SMS (선택)

### 2-4. API 인증 정보 발급

1. SolAPI 콘솔 → **"API 설정"** 또는 **"인증 정보"**
2. **API Key** 및 **API Secret** 발급
3. 복사 및 보관 (n8n Credential에 사용)

---

## 3단계: 알림톡 템플릿 등록

### 3-1. 카카오 비즈니스 채널 확인

SolAPI를 통해 알림톡을 발송하려면 카카오 비즈니스 채널이 필요합니다.

1. [카카오 비즈니스](https://business.kakao.com/) 접속
2. 채널 생성 및 인증 완료 확인
3. 채널 ID 확인

### 3-2. SolAPI에서 템플릿 등록

1. SolAPI 콘솔 → **"알림톡"** → **"템플릿 관리"**
2. **"템플릿 등록"** 클릭
3. 카카오 비즈니스 채널 선택
4. 템플릿 정보 입력

**템플릿 정보 입력:**

**템플릿 이름:**
```
예약 완료 안내
```

**템플릿 내용:**
```
#{guest_name}님, OUSCARAVAN 예약이 완료되었습니다!

📅 예약번호: #{reservation_number}
📅 체크인: #{checkin_date} 15:00
📅 체크아웃: #{checkout_date} 11:00
🏠 객실: #{room_type}
💰 결제금액: #{amount}원

컨시어지 서비스를 이용하시려면 아래 버튼을 클릭하세요.
```

**버튼 추가:**
- **버튼 유형**: 링크 버튼
- **버튼 이름**: `컨시어지 서비스 이용하기`
- **링크**: `#{service_link}` (템플릿 변수로 설정)

**템플릿 변수:**
- `#{guest_name}`: 게스트 이름
- `#{reservation_number}`: 예약번호
- `#{checkin_date}`: 체크인 날짜
- `#{checkout_date}`: 체크아웃 날짜
- `#{room_type}`: 객실 타입
- `#{amount}`: 결제금액
- `#{service_link}`: 컨시어지 서비스 링크

3. **저장** 클릭
4. 템플릿 승인 대기 (1-2일)

### 3-2. 채널 친구 추가 유도 템플릿 생성 (선택사항)

**템플릿 이름:**
```
채널 친구 추가 안내
```

**템플릿 내용:**
```
#{guest_name}님, OUSCARAVAN과 친구가 되어주세요!

친구 추가 시:
✓ 체크인/체크아웃 안내 메시지 수신
✓ 특별 혜택 및 프로모션 알림
✓ 빠른 고객 지원

아래 버튼을 클릭하여 친구 추가를 진행하세요.
```

**버튼 추가:**
- **버튼 유형**: 채널 추가 버튼
- **버튼 이름**: `친구 추가하기`

**참고:** 채널 친구 추가는 별도 템플릿이 아닌, 예약 완료 템플릿에 포함하거나 별도 발송 가능

---

## 4단계: 템플릿 ID 확인

### 4-1. 템플릿 승인 대기

템플릿 등록 후 카카오 비즈니스에서 승인 대기 (1-2일)

### 4-2. 템플릿 ID 확인

템플릿 승인 완료 후:

1. SolAPI 콘솔 → **"알림톡"** → **"템플릿 관리"**
2. 승인된 템플릿 클릭
3. **"템플릿 ID"** 또는 **"Template ID"** 복사
4. n8n 환경 변수에 저장

---

## 5단계: n8n SolAPI 노드 설정

### 5-1. SolAPI 노드 추가

1. n8n 워크플로우 편집
2. **"+" 버튼** 클릭
3. 검색창에 **"SolAPI"** 입력
4. **"SolAPI"** 노드 선택

### 5-2. SolAPI Credential 설정

1. **"Credential"** 드롭다운에서 **"Create New Credential"** 선택
2. **Credential Name**: `SolAPI OUSCARAVAN`
3. **API Key**: SolAPI에서 발급받은 API Key 입력
4. **API Secret**: SolAPI에서 발급받은 API Secret 입력
5. **Save** 클릭

### 5-3. SolAPI 노드 설정

**Operation**: `Send AlimTalk` (카카오 알림톡 발송)

**Parameters:**

| 필드 | 값 | 설명 |
|------|-----|------|
| `to` | `{{ $json.phone }}` | 수신자 전화번호 |
| `templateId` | `{{ $env.SOLAPI_ALIMTALK_TEMPLATE_ID }}` | 템플릿 ID |
| `variables` | 아래 JSON 참조 | 템플릿 변수 |

**Variables (템플릿 변수):**
```json
{
  "#{guest_name}": "{{ $json.guest }}",
  "#{reservation_number}": "{{ $json.reservationNumber }}",
  "#{checkin_date}": "{{ $json.checkin }}",
  "#{checkout_date}": "{{ $json.checkout }}",
  "#{room_type}": "{{ $json.room }}",
  "#{amount}": "{{ $json.amount }}",
  "#{service_link}": "{{ $json.link }}"
}
```

### 5-4. 전화번호 포맷 변환 노드 추가

**Code 노드 추가:**

```javascript
// 전화번호에서 하이픈 제거 및 포맷 정리
let phone = $input.item.json.phone || '';
phone = phone.replace(/[-\s()]/g, '');

if (phone.startsWith('010')) {
  phone = phone.substring(0, 11);
}

return {
  ...$input.item.json,
  phone: phone
};
```

### 5-5. 환경 변수 추가

n8n 환경 변수에 추가:

| Name | Value | 설명 |
|------|-------|------|
| `SOLAPI_ALIMTALK_TEMPLATE_ID` | 템플릿 ID | SolAPI에서 승인받은 템플릿 ID |
| `WEB_APP_URL` | 웹 앱 URL | 기존 유지 |

**참고:** SolAPI API Key와 Secret은 Credential로 관리하므로 환경 변수에 추가하지 않아도 됩니다.

---

## 6단계: 채널 친구 추가 유도

### 6-1. 알림톡 메시지에 친구 추가 버튼 포함

**템플릿 수정:**

예약 완료 템플릿에 채널 친구 추가 버튼 추가:

**템플릿 내용:**
```
#{guest_name}님, OUSCARAVAN 예약이 완료되었습니다!

📅 예약번호: #{reservation_number}
📅 체크인: #{checkin_date} 15:00
📅 체크아웃: #{checkout_date} 11:00
🏠 객실: #{room_type}
💰 결제금액: #{amount}원

컨시어지 서비스를 이용하시려면 아래 버튼을 클릭하세요.
```

**버튼 1: 링크 버튼**
- 이름: `컨시어지 서비스 이용하기`
- 링크: `#{service_link}`

**버튼 2: 채널 추가 버튼** (선택사항)
- 이름: `친구 추가하고 혜택받기`
- 채널 추가 링크

### 6-2. 별도 친구 추가 유도 메시지 발송 (선택사항)

예약 완료 후 1-2시간 후 별도로 친구 추가 유도 메시지 발송:

**새 템플릿 생성:**
- 템플릿 이름: `채널 친구 추가 유도`
- 메시지 내용: 친구 추가 혜택 안내
- 버튼: 채널 추가 버튼

**n8n 워크플로우:**
- 예약 완료 후 지연 노드 추가
- 친구 추가 유도 메시지 발송

---

## 7단계: 향후 마케팅을 위한 친구톡 활용

### 7-1. 친구 목록 관리

**정기적인 친구 목록 조회:**
- 주기적으로 친구 목록 조회
- 친구로 추가된 고객 목록 저장
- 마케팅 대상자 데이터베이스 구축

### 7-2. 마케팅 메시지 발송

**친구톡을 통한 마케팅:**
- 프로모션 안내
- 시즌별 특별 혜택
- 재방문 유도 메시지
- 리뷰 요청

**워크플로우 예시:**
```
Cron Trigger (매주 월요일)
  ↓
친구 목록 조회
  ↓
마케팅 메시지 템플릿 선택
  ↓
친구톡 발송
```

---

## 8단계: 테스트

### 8-1. 알림톡 발송 테스트

1. 테스트용 전화번호로 알림톡 발송
2. 메시지 수신 확인
3. 링크 버튼 동작 확인
4. 템플릿 변수 정확성 확인

### 8-2. 전체 플로우 테스트

1. 테스트용 네이버 예약 이메일 발송
2. n8n 워크플로우 자동 실행 확인
3. 알림톡 발송 확인
4. 웹 앱 링크 동작 확인

---

## 📋 체크리스트

### 카카오 비즈니스 설정
- [ ] 카카오 비즈니스 채널 생성
- [ ] 채널 인증 완료
- [ ] 알림톡 서비스 신청
- [ ] 알림톡 서비스 승인 완료

### 템플릿 설정
- [ ] 예약 완료 템플릿 등록
- [ ] 템플릿 승인 완료
- [ ] 템플릿 코드 확인
- [ ] 채널 친구 추가 유도 템플릿 등록 (선택)

### 개발자 콘솔 연동
- [ ] 앱과 채널 연결
- [ ] 알림톡 API 권한 확인

### n8n 설정
- [ ] 환경 변수 추가 (ALIMTALK_TEMPLATE_CODE)
- [ ] HTTP Request 노드 수정 (알림톡 API)
- [ ] 전화번호 포맷 변환 노드 추가
- [ ] 테스트 실행

### 테스트
- [ ] 알림톡 발송 테스트
- [ ] 전체 플로우 테스트
- [ ] 채널 친구 추가 유도 확인

---

## 🎯 최종 워크플로우 구조

```
[네이버 예약 완료]
  ↓
[예약 완료 이메일 발송]
  ↓
[n8n Gmail Trigger]
  ↓
[IF: 예약 확정/취소 구분]
  ↓
[Code: 이메일 파싱]
  ↓
[Set: 데이터 정리]
  ↓
[Code: 고유 링크 생성]
  ↓
[Code: 전화번호 포맷 변환]
  ↓
[HTTP Request: 알림톡 발송]
  ↓
[알림톡 수신]
  ↓
[게스트가 채널 친구 추가] (유도)
  ↓
[향후 마케팅 친구톡 발송]
```

---

**문서 버전**: 1.0  
**최종 업데이트**: 2024-01-15

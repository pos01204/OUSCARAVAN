# ì›¹ë·° í˜¸í™˜ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ ì‘ì—… ë¡œê·¸

> **ì‘ì—… ì‹œì‘ì¼**: 2026-01-19  
> **ì‘ì—… ì™„ë£Œì¼**: 2026-01-19  
> **ì‘ì—… ìƒíƒœ**: âœ… ì™„ë£Œ  
> **ê´€ë ¨ ë¬¸ì„œ**: [AUTH_WEBVIEW_IMPROVEMENT_PLAN.md](./AUTH_WEBVIEW_IMPROVEMENT_PLAN.md)

---

## ğŸ“‹ ì‘ì—… ìƒì„¸ ìš”ì²­ì„œ

### ëª©í‘œ
ì™¸ë¶€ ì•±(ì¹´ì¹´ì˜¤í†¡, ë„¤ì´ë²„ ë“±) ì›¹ë·°ì—ì„œë„ ì •ìƒì ìœ¼ë¡œ ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•œ í•˜ì´ë¸Œë¦¬ë“œ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„

### í•µì‹¬ ë³€ê²½ì‚¬í•­
1. **í† í° ì €ì¥**: httpOnly ì¿ í‚¤ â†’ localStorage (í´ë¼ì´ì–¸íŠ¸)
2. **í† í° ì „ì†¡**: Authorization í—¤ë” ìš°ì„ , ì¿ í‚¤ í´ë°±
3. **ë¡œê·¸ì¸ ë°©ì‹**: ì„œë²„ ì•¡ì…˜ â†’ í´ë¼ì´ì–¸íŠ¸ API í˜¸ì¶œ

### ì‘ì—… ë²”ìœ„

| ì˜ì—­ | íŒŒì¼ | ì‘ì—… ìœ í˜• | ìƒíƒœ |
|------|------|----------|------|
| ë°±ì—”ë“œ | `railway-backend/package.json` | ìˆ˜ì • | âœ… ì™„ë£Œ |
| ë°±ì—”ë“œ | `railway-backend/src/app.ts` | ìˆ˜ì • | âœ… ì™„ë£Œ |
| ë°±ì—”ë“œ | `railway-backend/src/middleware/auth.middleware.ts` | ìˆ˜ì • | âœ… ì™„ë£Œ |
| ë°±ì—”ë“œ | `railway-backend/src/routes/admin.routes.ts` | ìˆ˜ì • | âœ… ì™„ë£Œ |
| í”„ë¡ íŠ¸ì—”ë“œ | `lib/auth-client.ts` | ì‹ ê·œ ìƒì„± | âœ… ì™„ë£Œ |
| í”„ë¡ íŠ¸ì—”ë“œ | `lib/api.ts` | ìˆ˜ì • | âœ… ì™„ë£Œ |
| í”„ë¡ íŠ¸ì—”ë“œ | `app/(auth)/login/page.tsx` | ìˆ˜ì • | âœ… ì™„ë£Œ |
| í”„ë¡ íŠ¸ì—”ë“œ | `components/admin/AuthGuard.tsx` | ì‹ ê·œ ìƒì„± | âœ… ì™„ë£Œ |
| í”„ë¡ íŠ¸ì—”ë“œ | `components/admin/LogoutButton.tsx` | ì‹ ê·œ ìƒì„± | âœ… ì™„ë£Œ |
| í”„ë¡ íŠ¸ì—”ë“œ | `app/admin/layout.tsx` | ìˆ˜ì • | âœ… ì™„ë£Œ |

---

## ğŸ“ ì‘ì—… ì§„í–‰ ë¡œê·¸

### Phase 1: ë°±ì—”ë“œ ìˆ˜ì • âœ…

#### 1.1 cookie-parser íŒ¨í‚¤ì§€ ì„¤ì¹˜
- **ìƒíƒœ**: âœ… ì™„ë£Œ
- **ì™„ë£Œ ì‹œê°„**: 2026-01-19
- **íŒŒì¼**: `railway-backend/package.json`
- **ë³€ê²½ ë‚´ìš©**: 
  ```json
  // dependenciesì— ì¶”ê°€
  "cookie-parser": "^1.4.6"
  
  // devDependenciesì— ì¶”ê°€
  "@types/cookie-parser": "^1.4.6"
  ```

#### 1.2 app.ts ì¿ í‚¤ íŒŒì„œ ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€
- **ìƒíƒœ**: âœ… ì™„ë£Œ
- **ì™„ë£Œ ì‹œê°„**: 2026-01-19
- **íŒŒì¼**: `railway-backend/src/app.ts`
- **ë³€ê²½ ë‚´ìš©**: 
  ```typescript
  import cookieParser from 'cookie-parser';
  
  // ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€
  app.use(cookieParser());
  ```

#### 1.3 auth.middleware.ts í•˜ì´ë¸Œë¦¬ë“œ ì¸ì¦
- **ìƒíƒœ**: âœ… ì™„ë£Œ
- **ì™„ë£Œ ì‹œê°„**: 2026-01-19
- **íŒŒì¼**: `railway-backend/src/middleware/auth.middleware.ts`
- **ë³€ê²½ ë‚´ìš©**: 
  - `authenticate()`: Authorization í—¤ë” ìš°ì„ , ì¿ í‚¤ í´ë°±
  - `authenticateApiKey()`: n8n API Key ì¸ì¦
  - `authenticateOrApiKey()`: í•˜ì´ë¸Œë¦¬ë“œ ì¸ì¦ (ì‚¬ìš©ì/API Key)
  - `optionalAuthenticate()`: ì„ íƒì  ì¸ì¦

#### 1.4 admin.routes.ts ì¸ì¦ í™œì„±í™”
- **ìƒíƒœ**: âœ… ì™„ë£Œ
- **ì™„ë£Œ ì‹œê°„**: 2026-01-19
- **íŒŒì¼**: `railway-backend/src/routes/admin.routes.ts`
- **ë³€ê²½ ë‚´ìš©**: 
  ```typescript
  import { authenticateOrApiKey } from '../middleware/auth.middleware';
  
  // ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ í™œì„±í™”
  router.use(authenticateOrApiKey);
  ```

---

### Phase 2: í”„ë¡ íŠ¸ì—”ë“œ ìˆ˜ì • âœ…

#### 2.1 auth-client.ts ìƒì„±
- **ìƒíƒœ**: âœ… ì™„ë£Œ
- **ì™„ë£Œ ì‹œê°„**: 2026-01-19
- **íŒŒì¼**: `lib/auth-client.ts`
- **ì£¼ìš” í•¨ìˆ˜**:
  - `saveToken(token, expiresIn)`: í† í° ì €ì¥
  - `getToken()`: í† í° ì¡°íšŒ
  - `clearToken()`: í† í° ì‚­ì œ
  - `isAuthenticated()`: ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
  - `getAuthHeader()`: Authorization í—¤ë” ìƒì„±
  - `getTokenRemainingTime()`: í† í° ë§Œë£Œê¹Œì§€ ë‚¨ì€ ì‹œê°„
  - `shouldRefreshToken()`: í† í° ê°±ì‹  í•„ìš” ì—¬ë¶€

#### 2.2 api.ts ì¸ì¦ í—¤ë” ë¡œì§ ì¶”ê°€
- **ìƒíƒœ**: âœ… ì™„ë£Œ
- **ì™„ë£Œ ì‹œê°„**: 2026-01-19
- **íŒŒì¼**: `lib/api.ts`
- **ë³€ê²½ ë‚´ìš©**: 
  - `authenticatedFetch()`: ì¸ì¦ í—¤ë” í¬í•¨ fetch ë˜í¼
  - `adminApi()`: í•˜ì´ë¸Œë¦¬ë“œ ì¸ì¦ ì ìš©
  - 401 ì—ëŸ¬ ì‹œ ìë™ í† í° í´ë¦¬ì–´ ë° ë¦¬ë‹¤ì´ë ‰íŠ¸

#### 2.3 login/page.tsx í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë¡œ êµì²´
- **ìƒíƒœ**: âœ… ì™„ë£Œ
- **ì™„ë£Œ ì‹œê°„**: 2026-01-19
- **íŒŒì¼**: `app/(auth)/login/page.tsx`
- **ë³€ê²½ ë‚´ìš©**: 
  - ì„œë²„ ì•¡ì…˜ â†’ í´ë¼ì´ì–¸íŠ¸ API í˜¸ì¶œ
  - localStorage í† í° ì €ì¥
  - ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ ê°œì„ 
  - ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ/ìˆ¨ê¸°ê¸° ê¸°ëŠ¥
  - Suspenseë¡œ useSearchParams ë˜í•‘

#### 2.4 AuthGuard.tsx ìƒì„±
- **ìƒíƒœ**: âœ… ì™„ë£Œ
- **ì™„ë£Œ ì‹œê°„**: 2026-01-19
- **íŒŒì¼**: `components/admin/AuthGuard.tsx`
- **ê¸°ëŠ¥**:
  - ì¸ì¦ ìƒíƒœ í™•ì¸
  - ë¯¸ì¸ì¦ ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ ë¦¬ë‹¤ì´ë ‰íŠ¸
  - ë¡œë”© ìƒíƒœ í‘œì‹œ

#### 2.5 LogoutButton.tsx ìƒì„±
- **ìƒíƒœ**: âœ… ì™„ë£Œ
- **ì™„ë£Œ ì‹œê°„**: 2026-01-19
- **íŒŒì¼**: `components/admin/LogoutButton.tsx`
- **ê¸°ëŠ¥**:
  - í† í° ì‚­ì œ
  - ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™

#### 2.6 admin/layout.tsx AuthGuard ì ìš©
- **ìƒíƒœ**: âœ… ì™„ë£Œ
- **ì™„ë£Œ ì‹œê°„**: 2026-01-19
- **íŒŒì¼**: `app/admin/layout.tsx`
- **ë³€ê²½ ë‚´ìš©**: 
  - AuthGuardë¡œ children ë˜í•‘
  - LogoutButton ì¶”ê°€

---

## âœ… ì™„ë£Œëœ ì‘ì—… ìš”ì•½

| ì‘ì—… | ì™„ë£Œ ì‹œê°„ | ë¹„ê³  |
|------|----------|------|
| ë°±ì—”ë“œ: cookie-parser ì„¤ì¹˜ | 2026-01-19 | package.json ìˆ˜ì • |
| ë°±ì—”ë“œ: ì¿ í‚¤ íŒŒì„œ ë¯¸ë“¤ì›¨ì–´ | 2026-01-19 | app.ts ìˆ˜ì • |
| ë°±ì—”ë“œ: í•˜ì´ë¸Œë¦¬ë“œ ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ | 2026-01-19 | auth.middleware.ts ì „ë©´ ìˆ˜ì • |
| ë°±ì—”ë“œ: ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ í™œì„±í™” | 2026-01-19 | admin.routes.ts ìˆ˜ì • |
| í”„ë¡ íŠ¸ì—”ë“œ: auth-client.ts | 2026-01-19 | ì‹ ê·œ ìƒì„± |
| í”„ë¡ íŠ¸ì—”ë“œ: api.ts ì¸ì¦ ë¡œì§ | 2026-01-19 | authenticatedFetch ì¶”ê°€ |
| í”„ë¡ íŠ¸ì—”ë“œ: ë¡œê·¸ì¸ í˜ì´ì§€ | 2026-01-19 | í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë¡œ ì „í™˜ |
| í”„ë¡ íŠ¸ì—”ë“œ: AuthGuard | 2026-01-19 | ì‹ ê·œ ìƒì„± |
| í”„ë¡ íŠ¸ì—”ë“œ: LogoutButton | 2026-01-19 | ì‹ ê·œ ìƒì„± |
| í”„ë¡ íŠ¸ì—”ë“œ: admin/layout.tsx | 2026-01-19 | AuthGuard, LogoutButton ì ìš© |

---

## ğŸ”§ ë°°í¬ ì „ í•„ìˆ˜ ì‘ì—…

### Railway í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
# í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜
JWT_SECRET=<ê°•ë ¥í•œ-ì‹œí¬ë¦¿-í‚¤-32ì-ì´ìƒ>
N8N_API_KEY=<n8n-ìë™í™”ìš©-API-í‚¤>
```

### ë°±ì—”ë“œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
cd railway-backend
npm install
```

### í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì¼ë°˜ ë¸Œë¼ìš°ì €ì—ì„œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
- [ ] ì¹´ì¹´ì˜¤í†¡ ì›¹ë·°ì—ì„œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
- [ ] ë„¤ì´ë²„ ì•± ì›¹ë·°ì—ì„œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
- [ ] ë¡œê·¸ì•„ì›ƒ í›„ ì¬ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
- [ ] ì„¸ì…˜ ë§Œë£Œ í›„ ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸ í…ŒìŠ¤íŠ¸
- [ ] n8n API Key ì¸ì¦ í…ŒìŠ¤íŠ¸

---

## ğŸ“ ë³€ê²½ëœ íŒŒì¼ ëª©ë¡

### ë°±ì—”ë“œ (railway-backend/)
```
railway-backend/
â”œâ”€â”€ package.json                              # cookie-parser ì¶”ê°€
â””â”€â”€ src/
    â”œâ”€â”€ app.ts                                # cookieParser ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€
    â”œâ”€â”€ middleware/
    â”‚   â””â”€â”€ auth.middleware.ts                # í•˜ì´ë¸Œë¦¬ë“œ ì¸ì¦ êµ¬í˜„
    â””â”€â”€ routes/
        â””â”€â”€ admin.routes.ts                   # ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ í™œì„±í™”
```

### í”„ë¡ íŠ¸ì—”ë“œ
```
lib/
â”œâ”€â”€ auth-client.ts                            # ì‹ ê·œ: í´ë¼ì´ì–¸íŠ¸ í† í° ê´€ë¦¬
â””â”€â”€ api.ts                                    # ìˆ˜ì •: authenticatedFetch ì¶”ê°€

app/
â”œâ”€â”€ (auth)/
â”‚   â””â”€â”€ login/
â”‚       â””â”€â”€ page.tsx                          # ìˆ˜ì •: í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸
â””â”€â”€ admin/
    â””â”€â”€ layout.tsx                            # ìˆ˜ì •: AuthGuard ì ìš©

components/
â””â”€â”€ admin/
    â”œâ”€â”€ AuthGuard.tsx                         # ì‹ ê·œ: ì¸ì¦ ìƒíƒœ í™•ì¸
    â””â”€â”€ LogoutButton.tsx                      # ì‹ ê·œ: ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
```

---

## ğŸ”„ ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë³€ê²½ ë‚´ìš© | ë³€ê²½ì |
|------|----------|--------|
| 2026-01-19 | ì‘ì—… ë¡œê·¸ ë¬¸ì„œ ìƒì„± | AI |
| 2026-01-19 | ë°±ì—”ë“œ ì‘ì—… ì™„ë£Œ (Phase 1) | AI |
| 2026-01-19 | í”„ë¡ íŠ¸ì—”ë“œ ì‘ì—… ì™„ë£Œ (Phase 2) | AI |
| 2026-01-19 | ì‘ì—… ì™„ë£Œ, ë¬¸ì„œ ìµœì¢… ì—…ë°ì´íŠ¸ | AI |

---

## ğŸ“Œ ì°¸ê³  ì‚¬í•­

### ì¸ì¦ íë¦„ ìš”ì•½
```
1. ë¡œê·¸ì¸ ìš”ì²­
   â””â”€â”€ POST /api/auth/login (id, password)
   
2. í† í° ë°œê¸‰
   â””â”€â”€ JWT í† í° ë°˜í™˜ (7ì¼ ìœ íš¨)
   
3. í† í° ì €ì¥
   â””â”€â”€ localStorageì— ì €ì¥ (ì›¹ë·° í˜¸í™˜)
   
4. API í˜¸ì¶œ
   â””â”€â”€ Authorization: Bearer <token> í—¤ë”ë¡œ ì „ì†¡
   
5. ì¸ì¦ ê²€ì¦ (ë°±ì—”ë“œ)
   â”œâ”€â”€ 1ìˆœìœ„: Authorization í—¤ë”
   â””â”€â”€ 2ìˆœìœ„: ì¿ í‚¤ (í´ë°±)
   
6. ë¡œê·¸ì•„ì›ƒ
   â””â”€â”€ localStorage í† í° ì‚­ì œ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ ì´ë™
```

### ë³´ì•ˆ ê³ ë ¤ì‚¬í•­
- localStorageëŠ” XSS ê³µê²©ì— ì·¨ì•½í•  ìˆ˜ ìˆìŒ
- í”„ë¡œë•ì…˜ì—ì„œëŠ” Content Security Policy (CSP) ì„¤ì • ê¶Œì¥
- JWT_SECRETì€ ì¶©ë¶„íˆ ê°•ë ¥í•œ ê°’ ì‚¬ìš© (32ì ì´ìƒ)

---

*ì´ ë¬¸ì„œëŠ” ì›¹ë·° í˜¸í™˜ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ ì‘ì—…ì˜ ì „ì²´ ë¡œê·¸ì…ë‹ˆë‹¤.*

# 방 관리 페이지 완전 개선

## 🔍 문제 분석

**증상:**
- 방 관리 페이지의 방 목록이 업데이트되지 않음
- 선택 가능한 방이 하나밖에 나오지 않음
- 방 이름에 "오션뷰 카라반" 구분이 불필요함

**요구사항:**
1. 기본 10개 방 표시 (1호~10호)
2. 방 이름을 "1호", "2호" 등으로만 표시
3. 각 방의 배정 정보 표시:
   - 배정되었을 시: 예약자 이름, 체크인/체크아웃 날짜, 상태
   - 배정되지 않았을 시: 미배정
4. 고객 페이지 테스트 링크 제공

---

## ✅ 해결 방법

### 1. Railway 방 서비스 개선

**파일:** `railway-backend/src/services/rooms.service.ts`

**변경 사항:**
- `getRooms()` 함수에 배정 정보 포함
- LEFT JOIN으로 현재 예약 정보 조회
- 숫자 순서로 정렬 (1호, 2호, ... 10호)

**주요 쿼리:**
```sql
SELECT 
  r.id, r.name, r.type, r.capacity, r.status,
  res.id as reservation_id,
  res.guest_name,
  res.checkin,
  res.checkout,
  res.status as reservation_status
FROM rooms r
LEFT JOIN reservations res ON res.assigned_room = r.name 
  AND res.status IN ('assigned', 'checked_in', 'checked_out')
  AND res.checkin <= CURRENT_DATE 
  AND res.checkout >= CURRENT_DATE
ORDER BY CAST(r.name AS INTEGER) ASC
```

### 2. Railway 방 컨트롤러 수정

**파일:** `railway-backend/src/controllers/rooms.controller.ts`

**변경 사항:**
- `listRooms()` 함수가 배열을 직접 반환하도록 수정
- 배정 정보가 포함된 방 목록 반환

### 3. 방 관리 페이지 개선

**파일:** `app/admin/rooms/page.tsx`

**변경 사항:**
- 방 추가/수정/삭제 기능 제거
- 배정 정보 표시 추가
- 방 이름을 "1호", "2호" 등으로 표시
- 숫자 순서로 정렬

**표시 정보:**
- 방 이름: "1호", "2호", ... "10호"
- 수용 인원: "4인실", "2인실"
- 배정 정보:
  - 배정됨: 예약자 이름, 체크인/체크아웃 날짜, 상태 배지
  - 미배정: "미배정" 텍스트

### 4. 예약 상세 페이지 개선

**파일:** `app/admin/reservations/[id]/page.tsx`

**변경 사항:**
- 방 선택 드롭다운에 모든 방 표시 (1호~10호)
- 방 이름 표시 형식: "1호 (4인실)", "2호 (4인실)" 등
- 고객 페이지 링크에 "새 창에서 열기" 버튼 추가

### 5. 기본 방 데이터 마이그레이션

**파일:** `railway-backend/migrations/002_default_rooms.sql`

**변경 사항:**
- 오션뷰 전용
- 4인실 8개 (1호~8호)
- 2인실 2개 (9호~10호)
- 방 이름: "1호", "2호", ... "10호" (숫자만)

---

## 🚀 변경 사항

### 방 관리 페이지 UI

**방 카드 표시:**
```
┌─────────────────┐
│ 1호    [사용 가능] │
│ 4인실            │
│                 │
│ 배정 정보        │
│ 배*윤님          │
│ 2026. 1. 22. ~  │
│ 2026. 1. 23.    │
│ [체크인]         │
└─────────────────┘
```

또는

```
┌─────────────────┐
│ 2호    [사용 가능] │
│ 4인실            │
│                 │
│ 배정 정보        │
│ 미배정           │
└─────────────────┘
```

### 예약 상세 페이지

**방 선택 드롭다운:**
- 1호 (4인실)
- 2호 (4인실)
- ...
- 10호 (2인실)

**고객 페이지 링크:**
- 링크 텍스트 표시
- "새 창에서 열기" 버튼

---

## 📋 체크리스트

### Railway:
- [x] 방 서비스에 배정 정보 포함 완료
- [x] 방 컨트롤러 수정 완료
- [x] 기본 방 데이터 마이그레이션 수정 완료
- [ ] Railway 마이그레이션 실행
- [ ] Railway 배포 완료

### Vercel:
- [x] 방 관리 페이지 개선 완료
- [x] 예약 상세 페이지 개선 완료
- [x] 고객 페이지 테스트 링크 추가 완료
- [ ] Vercel 배포 완료
- [ ] 테스트 완료

### 테스트:
- [ ] 방 목록 10개 표시 확인
- [ ] 방 이름 "1호", "2호" 등으로 표시 확인
- [ ] 배정 정보 표시 확인
- [ ] 예약 상세 페이지에서 모든 방 선택 가능 확인
- [ ] 고객 페이지 링크 작동 확인

---

## 🔗 고객 페이지 테스트 링크

**링크 형식:**
```
https://ouscaravan.vercel.app/guest/{uniqueToken}
```

**테스트 방법:**
1. 예약 상세 페이지에서 방 배정 및 전화번호 입력
2. 저장 후 고객 페이지 링크 확인
3. "새 창에서 열기" 버튼 클릭
4. 고객 페이지에서 체크인/체크아웃 기능 테스트

**고객 페이지 기능:**
- 홈: 예약 정보 확인
- 가이드: 이용 가이드
- 주문: BBQ/장작 주문
- 체크인/체크아웃: 체크인/체크아웃 처리
- 도움말: 고객 지원

---

## 🎯 핵심 개선 사항

1. **방 목록 개선**: 배정 정보 포함, 숫자 순서 정렬
2. **방 이름 단순화**: "1호", "2호" 등으로만 표시
3. **배정 정보 표시**: 예약자 이름, 날짜, 상태 표시
4. **고객 페이지 링크**: 테스트용 링크 제공

---

**문서 버전**: 1.0  
**최종 업데이트**: 2026-01-06

{
  "name": "ë„¤ì´ë²„ ì˜ˆì•½ â†’ ì¹´ì¹´ì˜¤í†¡ ë°œì†¡",
  "nodes": [
    {
      "parameters": {
        "content": "### ğŸ“° Daily AI Summary\n\n\nThis workflow gets the latest news and asks AI to summarize it for you.\n\nâ­ Bonus: Send the summary via email by connecting your Gmail account\n\nâ–¶ Watch the video to get started ",
        "height": 272,
        "width": 224,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -624,
        32
      ],
      "id": "74d80857-5e63-47a8-8e86-8ecd10fd5f9e",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "filters": {
          "q": "subject:[ë„¤ì´ë²„ ì˜ˆì•½]",
          "sender": "naverbooking_noreply@navercorp.com"
        }
      },
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1.3,
      "position": [
        -80,
        688
      ],
      "id": "e90ff887-c31d-4617-9f9c-db43f402117d",
      "name": "Gmail Trigger1",
      "credentials": {
        "gmailOAuth2": {
          "id": "8uOCeR25M6sEtgbJ",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 1. ë°ì´í„° ê°€ì ¸ì˜¤ê¸°\nconst inputData = $input.item.json;\nconst allInputs = $input.all();\n\n// HTML ë…¸ë“œë¡œë¶€í„° ë°ì´í„°ê°€ ë„˜ì–´ì™”ëŠ”ì§€ í™•ì¸\nconst hasHtmlOutput = !!(inputData['ì˜ˆì•½ë²ˆí˜¸'] || inputData['ì˜ˆì•½ìëª…']);\n\nlet reservationNumber = '';\nlet guestName = '';\nlet email = '';\nlet checkin = '';\nlet checkout = '';\nlet roomType = '';\nlet amount = 0;\nlet roomAmount = 0; // ì¶”ê°€ëœ í•„ë“œ\nlet options = [];\n\nif (hasHtmlOutput) {\n  const data = inputData; \n\n  // ì˜ˆì•½ë²ˆí˜¸ ì¶”ì¶œ\n  if (data['ì˜ˆì•½ë²ˆí˜¸']) {\n    const resNoMatch = data['ì˜ˆì•½ë²ˆí˜¸'].match(/(\\d+)/);\n    reservationNumber = resNoMatch ? resNoMatch[1] : '';\n  }\n\n  // ì˜ˆì•½ìëª… ì¶”ì¶œ\n  if (data['ì˜ˆì•½ìëª…']) {\n    guestName = data['ì˜ˆì•½ìëª…'].replace(/ë‹˜\\s*$/, '').trim();\n  }\n\n  // ì´ìš©ì¼ì‹œì—ì„œ ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ ì¶”ì¶œ\n  if (data['ì´ìš©ì¼ì‹œ']) {\n    const dates = data['ì´ìš©ì¼ì‹œ'].match(/\\d{4}\\.\\d{2}\\.\\d{2}/g);\n    if (dates) {\n      checkin = dates[0].replace(/\\./g, '-');\n      checkout = dates[1] ? dates[1].replace(/\\./g, '-') : '';\n    }\n  }\n\n  // ìƒí’ˆëª… ì¶”ì¶œ\n  if (data['ìƒí’ˆëª…']) {\n    roomType = data['ìƒí’ˆëª…'].trim();\n  }\n\n  // ê²°ì œê¸ˆì•¡ì—ì„œ ì´ì•¡, ê°ì‹¤ê°€, ì˜µì…˜ ì¶”ì¶œ\n  if (data['ê²°ì œê¸ˆì•¡']) {\n    // ìµœì¢… í•©ê³„ ê¸ˆì•¡ íŒŒì‹±\n    const totalMatch = data['ê²°ì œê¸ˆì•¡'].match(/=\\s*([\\d,]+)\\s*ì›/);\n    if (totalMatch) {\n      amount = parseInt(totalMatch[1].replace(/,/g, '')) || 0;\n    }\n\n    // ì„¸ë¶€ í•­ëª© íŒŒì‹± (+ ê¸°í˜¸ ê¸°ì¤€ ë¶„ë¦¬)\n    const parts = data['ê²°ì œê¸ˆì•¡'].split('=')[0].split('+');\n    parts.forEach(p => {\n      const priceMatch = p.match(/([\\d,]+)\\s*ì›/);\n      const price = priceMatch ? parseInt(priceMatch[0].replace(/,/g, '')) : 0;\n\n      if (p.includes(\"ì˜ˆì•½\")) { \n        // ê°ì‹¤ ê°€ê²© ì„¤ì •\n        roomAmount = price;\n      } else { \n        // ì˜µì…˜ ì¶”ì¶œ ë¡œì§\n        const nameMatch = p.match(/\\[(.*?)\\]\\s*(.*?)\\s*\\d+ì›/);\n        if (nameMatch) {\n          options.push({\n            optionName: nameMatch[2].trim(),\n            optionPrice: price,\n            category: nameMatch[1].trim()\n          });\n        }\n      }\n    });\n  }\n\n  // ì´ë©”ì¼ ì£¼ì†Œ ë³´ì •: ê°’ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ í˜•ì‹ ìƒì„±\n  const foundEmail = allInputs[0]?.json?.from?.value?.[0]?.address;\n  email = foundEmail || `reservation-${reservationNumber}@ouscaravan.local`;\n}\n\n// 2. ìµœì¢… ê²°ê³¼ ë°˜í™˜\nreturn {\n  json: {\n    reservationNumber,\n    guestName,\n    checkin,\n    checkout,\n    amount,\n    roomType,\n    roomAmount, // ì¶”ê°€ë¨\n    category: \"ROOM\",\n    email,\n    options: options // HTTP Requestì—ì„œ ë°”ë¡œ ì“¸ ìˆ˜ ìˆë„ë¡ ë°°ì—´ ìœ ì§€\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        608,
        688
      ],
      "id": "808c38b3-8277-4ffd-b4f4-68aed954a215",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://ouscaravan-production.up.railway.app/api/admin/reservations",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-Key",
              "value": "YjMzYTBlYzEtM2RjOS00MDBkLTgxZjEtMjc3YzQyMTg1N2M0YzNjYThlZTYtMWI2MC00MDYzLTlmNzktMDgxN2IyODIxOGQ3"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"reservationNumber\": \"{{ $json.reservationNumber }}\",\n  \"guestName\": \"{{ $json.guestName }}\",\n  \"checkin\": \"{{ $json.checkin }}\",\n  \"checkout\": \"{{ $json.checkout }}\",\n  \"amount\": {{ $json.amount }},\n  \"roomType\": \"{{ $json.roomType }}\",\n  \"roomAmount\": {{ $json.roomAmount }},\n  \"category\": \"ROOM\",\n  \"email\": \"reservation-{{ $json.reservationNumber }}@ouscaravan.local\",\n  \"options\": {{ JSON.stringify($json.options) }}\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        864,
        688
      ],
      "id": "fea7fad9-80c5-4a52-b779-beeca76658c5",
      "name": "HTTP Request2",
      "credentials": {
        "httpHeaderAuth": {
          "id": "P1cCOMocVbajLBcy",
          "name": "Railway API Key"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "messageId": "={{ $json.id }}",
        "simple": false,
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        176,
        688
      ],
      "id": "b3b9c26f-e1d3-4800-9bed-db11aca51cc9",
      "name": "Get a message",
      "webhookId": "46e19de6-b4c0-4f9b-9630-91512249fb70",
      "credentials": {
        "gmailOAuth2": {
          "id": "8uOCeR25M6sEtgbJ",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "operation": "extractHtmlContent",
        "dataPropertyName": "html",
        "extractionValues": {
          "values": [
            {
              "key": "ì˜ˆì•½ë²ˆí˜¸",
              "cssSelector": "td:contains('ì˜ˆì•½ë²ˆí˜¸') + td"
            },
            {
              "key": "ì˜ˆì•½ìëª…",
              "cssSelector": "td:contains('ì˜ˆì•½ìëª…') + td"
            },
            {
              "key": "ì´ìš©ì¼ì‹œ",
              "cssSelector": "td:contains('ì´ìš©ì¼ì‹œ') + td"
            },
            {
              "key": "ê²°ì œê¸ˆì•¡",
              "cssSelector": "td:contains('ê²°ì œê¸ˆì•¡') + td"
            },
            {
              "key": "ìƒí’ˆëª…",
              "cssSelector": "td:contains('ì˜ˆì•½ìƒí’ˆ') + td"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        384,
        688
      ],
      "id": "a0b11f7e-153d-42d8-96c6-697d1c09b51e",
      "name": "HTML1"
    }
  ],
  "connections": {
    "Gmail Trigger1": {
      "main": [
        [
          {
            "node": "Get a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        []
      ]
    },
    "Get a message": {
      "main": [
        [
          {
            "node": "HTML1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML1": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "availableInMCP": false
  },
  "staticData": {
    "node:Gmail Trigger": {
      "Gmail Trigger": {
        "lastTimeChecked": 1767684140
      }
    },
    "node:Gmail Trigger1": {
      "Gmail Trigger1": {
        "lastTimeChecked": 1768955073,
        "possibleDuplicates": [
          "19bddf05fe6f9cef",
          "19bdbc8372e44e8b"
        ]
      }
    }
  },
  "pinData": {},
  "triggerCount": 1,
  "meta": {
    "templateId": "ready-to-run-ai-workflow",
    "templateCredsSetupCompleted": true
  }
}
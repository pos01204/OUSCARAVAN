# 로그인 세션 풀림 문제 수정

## 📋 문제 상황

방 관리 메뉴 클릭 시 로그인이 풀리며 자동으로 로그인창으로 튕기는 문제가 발생했습니다.

## 🔍 원인 분석

1. **임시 토큰 사용**: `lib/auth.ts`에서 임시 토큰을 생성하고 있었지만, Railway API는 JWT 토큰을 기대합니다.
2. **401 에러 처리**: API 호출 실패 시 401 에러가 발생하면 즉시 로그인 페이지로 리다이렉트되었습니다.
3. **아이콘 404 에러**: `manifest.json`에서 참조하는 아이콘 파일이 없어서 경고가 발생했습니다.

## ✅ 수정 내용

### 1. Railway API 연동 (`lib/auth.ts`)

- `adminLogin` 함수를 Railway API를 호출하도록 수정
- Railway API에서 받은 JWT 토큰을 쿠키에 저장
- 네트워크 오류 처리 추가

### 2. 401 에러 처리 개선 (`lib/api.ts`)

- 401 에러 발생 시 즉시 리다이렉트하지 않고, 컴포넌트에서 처리하도록 변경
- 쿠키 삭제는 `adminApi` 함수에서 처리
- 리다이렉트는 컴포넌트에서 처리

### 3. 방 관리 페이지 에러 처리 개선 (`app/admin/rooms/page.tsx`)

- 401 에러 감지 시 쿠키 삭제 후 로그인 페이지로 리다이렉트
- 사용자 친화적인 에러 메시지 표시

### 4. 아이콘 404 에러 수정

- `app/manifest.ts`에서 아이콘 참조 제거 (주석 처리)
- `public/manifest.json`에서 아이콘 배열 제거

## 🧪 테스트 방법

1. **로그인 테스트**
   - 관리자 로그인 페이지에서 로그인
   - Railway API를 통해 JWT 토큰을 받아오는지 확인

2. **방 관리 페이지 테스트**
   - 방 관리 메뉴 클릭
   - 방 목록이 정상적으로 로드되는지 확인
   - 로그인이 풀리지 않는지 확인

3. **에러 처리 테스트**
   - Railway API가 다운된 상태에서 로그인 시도
   - 네트워크 오류 메시지가 표시되는지 확인

## 📝 참고 사항

- Railway API URL이 `NEXT_PUBLIC_API_URL` 환경 변수에 올바르게 설정되어 있어야 합니다.
- Railway API의 `/api/auth/login` 엔드포인트가 정상적으로 작동해야 합니다.
- JWT 토큰이 올바르게 생성되고 검증되어야 합니다.

---

**수정 일자**: 2024-01-15  
**수정 파일**:
- `lib/auth.ts`
- `lib/api.ts`
- `app/admin/rooms/page.tsx`
- `app/manifest.ts`
- `public/manifest.json`
